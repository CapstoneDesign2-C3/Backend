<?xml version = "1.0" encoding = "UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="capstone.design.control_automation.mapper.camera.CameraMapper">
  <select id="findAllByFilterCondition" resultType="CameraPosition">
    SELECT c.camera_id, c.lat, c.lon
    FROM camera_info c
    <where>
      <if test="topLeftLatitude != null
          and topLeftLongitude != null
          and bottomRightLatitude != null
          and bottomRightLongitude != null">
        c.lat BETWEEN #{bottomRightLatitude} AND #{topLeftLatitude}
        AND c.lon BETWEEN #{topLeftLongitude} AND #{bottomRightLongitude}
      </if>
    </where>
  </select>

  <select id="findWithVideosById" resultType="CameraInfo">
    SELECT DISTINCT c.camera_id, c.camera_name, c.lat, c.lon, v.id, v.thumbnail_url, v.start_time, v.end_time
    FROM camera_info c
    LEFT JOIN public.video v on c.camera_id = v.camera_id
    WHERE c.camera_id = #{cameraId}
  </select>

  <select id="getCameras" resultType="Camera">
    SELECT c.camera_id, c.camera_ip, c.camera_port, c.lat, c.lon, c.location_name, c.location_address, c.location_address_detail, c.rtsp_id, c.rtsp_password, c.stream_path, c.camera_name
    FROM camera_info c
  </select>

  <insert id="insertCamera" parameterType="CameraReqeust" useGeneratedKeys="true" keyProperty="cameraId">
    INSERT INTO camera_info (
    camera_ip,
    camera_port,
    lat,
    lon,
    location_name,
    location_address,
    location_address_detail,
    rtsp_id,
    rtsp_password,
    stream_path,
    camera_name
    ) VALUES (
    #{cameraIP},
    #{cameraPort},
    #{latitude},
    #{longitude},
    #{locationName},
    #{locationAddress},
    #{locationAddressDetail},
    #{rtspID},
    #{rtspPassword},
    #{streamPath},
    #{cameraName}
    )
  </insert>
</mapper>
